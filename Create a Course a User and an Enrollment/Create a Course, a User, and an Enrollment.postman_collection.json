{
	"info": {
		"_postman_id": "8273279d-7a3a-4404-a084-ef68913ef4fb",
		"name": "Create a Course, a User, and an Enrollment",
		"description": "Create a Course, a User, and an Enrollment\r\n\r\n\r\nThis Postman Collection provides a recipe for creating a new Course Offering, and a new Brightspace User. Lastly, it enrolls the new User into the new Course Offering.\r\n\r\n\r\nOfficial API Documentation for this Collection:\r\nhttps://docs.valence.desire2learn.com/res/course.html#post--d2l-api-lp-(version)-courses-\r\nhttps://docs.valence.desire2learn.com/res/user.html#post--d2l-api-lp-(version)-users-\r\nhttps://docs.valence.desire2learn.com/res/enroll.html#post--d2l-api-lp-(version)-enrollments-\r\n\r\nFor this Collection your Brightspace user account will require the following Brightspace Permission(s):\r\n- Manage Courses - Has Access to the Manage Courses tool\r\n- Manage Courses - Create Courses Offerings and Templates\r\n- Users - Create a User in the Database\r\n- Users - Enroll '{The role you plan to use}'\r\n\r\nOAuth 2.0 Scopes\r\n- ensure that your OAuth2.0 app, and access token, have the following OAuth Scopes granted:\r\ncore:*:*\r\nusers:userdata:create\r\nenrollment:orgunit:create\r\n\r\n\r\nStep 1 - Populate Collection Variables\r\n\r\nEdit this Collection, and update the Collection Variable values with appropriate values for your Brightspace site.\r\n\r\n- BrightspaceDomain\r\n- accesstoken\r\n- refreshtoken\r\n\r\nIt is recommended to paste your values in the \"Current Value\" field of each Collection Variable.\r\n\r\nNote: accesstoken and refreshtoken retrieval is explained in the \"Get Initial Token\" Collection. If you need to get a new Access Token then run the \"Request a New Access Token and Refresh Token\" request provided in this collection.\r\n\r\nNote: the lpversion variable is pre-set to 1.28 in this Collection.\r\n\r\n\r\nStep 2 - Prepare to Create a Course Offering\r\n\r\nA Brightspace Course Offering is an Org Unit which requires a Parent Course Template org unit. It does not require, but it is recommended to have, a Parent Semester org unit. This example does not require a Semester parent.\r\n\r\nDetermine the OrgUnitId of the Course Template org unit that will be the parent for your new Course Offering. Place its OrgUnitId value in the following Collection variable:\r\n- CourseTemplateId\r\n\r\nNote: The Brightspace Org Unit Editor may be required to determine the above information.\r\n\r\nNote: You should explore (and update if you want) the input JSON Body for this call. The input JSON needs to align with this documentation: https://docs.valence.desire2learn.com/res/course.html#Course.CourseOffering\r\n\r\n\r\nStep 3 - Create a New Course Offering\r\n\r\nRun the Create a Course Offering request. \r\n\r\nYou should get a 200 OK, plus a JSON block detailing your new Course Offering.\r\n\r\nThis Request stores the OrgUnitId of the new Course Offering in the CourseOfferingId collection varibale.\r\n\r\n\r\nStep 4 - Prepare to Create a New User\r\n\r\nWhen a Brightspace User is created a RoleId value is required. This RoleId value is used to enroll the new user into the Organization Org Unit.\r\n\r\nDetermine the RoleId that you want to assign to this User. Place this RoleId value in the following Collection variable:\r\n- RoleId\r\n\r\nNote: The Brightspace Roles and Permissions tool may be required to determine this value.\r\n\r\nNote: You should explore (and update if you want) the input JSON Body for this call. The input JSON needs to align with this documentation: https://docs.valence.desire2learn.com/res/user.html#User.CreateUserData\r\n\r\n\r\nStep 5 - Create a New User\r\n\r\nRun the Create a User request. \r\n\r\nYou should get a 200 OK, plus a JSON block detailing your new User.\r\n\r\nThis Request stores the UserId of the new User in the UserId collection varibale.\r\n\r\n\r\nStep 6 - Enroll your User into your Course\r\n\r\nRun the Enroll User into the Course Offering request.\r\n\r\nYou should get a 200 OK, plus a JSON response confirming the Enrollment data.\r\n",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Request a New Access Token and Refresh Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "2f883fb6-7c40-433a-bf92-6d2499922ce9",
						"exec": [
							"if (pm.response.code == 200) {\r",
							"    var jsonData = JSON.parse(responseBody);\r",
							"\r",
							"    // Use these two calls if you are using Collection Variables\r",
							"    pm.collectionVariables.set(\"accesstoken\", jsonData.access_token);\r",
							"    pm.collectionVariables.set(\"refreshtoken\", jsonData.refresh_token);\r",
							"\r",
							"//    Use these two calls if you are using Environment Variables\r",
							"//    postman.setEnvironmentVariable(\"accesstoken\", jsonData.access_token);\r",
							"//    postman.setEnvironmentVariable(\"refreshtoken\", jsonData.refresh_token);\r",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "refresh_token",
							"type": "text"
						},
						{
							"key": "refresh_token",
							"value": "{{refreshtoken}}",
							"type": "text"
						},
						{
							"key": "client_id",
							"value": "{{clientid}}",
							"type": "text"
						},
						{
							"key": "client_secret",
							"value": "{{clientsecret}}",
							"type": "text"
						},
						{
							"key": "scope",
							"value": "{{oauth2scope}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "https://auth.brightspace.com/core/connect/token",
					"protocol": "https",
					"host": [
						"auth",
						"brightspace",
						"com"
					],
					"path": [
						"core",
						"connect",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a Course Offering",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "fc79f968-05d1-4b98-87af-af66094d9d5d",
						"exec": [
							"var jsonData = JSON.parse(responseBody);\r",
							"pm.collectionVariables.set(\"CourseOfferingId\", jsonData.Identifier);\r",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"Name\": \"Course - {{$randomPhrase}}\",\r\n    \"Code\": \"CO-{{$guid}}\",\r\n    \"Path\": \"\",\r\n    \"CourseTemplateId\": {{CourseTemplateId}},\r\n    \"SemesterId\": null,\r\n    \"StartDate\": null,\r\n    \"EndDate\": null,\r\n    \"LocaleId\": null,\r\n    \"ForceLocale\": false,\r\n    \"ShowAddressBook\": false,\r\n    \"Description\": {\r\n           \"Content\": \"This is a new Course Offering\",\r\n           \"Type\": \"Text\"\r\n        },\r\n    \"CanSelfRegister\": false\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BrightspaceDomain}}/d2l/api/lp/{{lpversion}}/courses/",
					"host": [
						"{{BrightspaceDomain}}"
					],
					"path": [
						"d2l",
						"api",
						"lp",
						"{{lpversion}}",
						"courses",
						""
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a User",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "a1973cca-48a1-452d-a535-b628dd84afe7",
						"exec": [
							"var jsonData = JSON.parse(responseBody);\r",
							"pm.collectionVariables.set(\"UserId\", jsonData.UserId);\r",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"OrgDefinedId\": \"OrgDefinedId-{{$randomInt}}\",\r\n    \"FirstName\": \"{{$randomFirstName}}\",\r\n    \"MiddleName\": \"{{$randomFirstName}}\",\r\n    \"LastName\": \"{{$randomLastName}}\",\r\n    \"ExternalEmail\": \"{{$randomEmail}}\",\r\n    \"UserName\": \"d2l-{{$guid}}\",\r\n    \"RoleId\": {{RoleId}},\r\n    \"IsActive\": true,\r\n    \"SendCreationEmail\": false\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BrightspaceDomain}}/d2l/api/lp/{{lpversion}}/users/",
					"host": [
						"{{BrightspaceDomain}}"
					],
					"path": [
						"d2l",
						"api",
						"lp",
						"{{lpversion}}",
						"users",
						""
					]
				}
			},
			"response": []
		},
		{
			"name": "Enroll User into the Course Offering",
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"OrgUnitId\": {{CourseOfferingId}},\r\n    \"UserId\": {{UserId}},\r\n    \"RoleId\": {{RoleId}}, \r\n    \"IsCascading\": false\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{BrightspaceDomain}}/d2l/api/lp/{{lpversion}}/enrollments/",
					"host": [
						"{{BrightspaceDomain}}"
					],
					"path": [
						"d2l",
						"api",
						"lp",
						"{{lpversion}}",
						"enrollments",
						""
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{accesstoken}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "7f54ec9c-50ed-484d-be4d-7620f1fbe8e8",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "417e0422-0540-471a-a949-be087cee5c7d",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "cbccece2-d8c2-4111-aee9-af6bb05daeb2",
			"key": "accesstoken",
			"value": ""
		},
		{
			"id": "bc1b8796-0a50-4df7-80b9-d1f87107cab1",
			"key": "refreshtoken",
			"value": ""
		},
		{
			"id": "4eacd773-8caf-42db-aa35-70bdda8e63ca",
			"key": "BrightspaceDomain",
			"value": "https://devcop.brightspace.com"
		},
		{
			"id": "91c11b49-69cd-4e4a-acb5-25eff4ef23cc",
			"key": "lpversion",
			"value": "1.28"
		},
		{
			"id": "6905cf04-5c04-43f8-8f13-6e7fead34692",
			"key": "CourseTemplateId",
			"value": ""
		},
		{
			"id": "1fbf8a68-a581-4aeb-8ba4-42cac6fdefc9",
			"key": "CourseOfferingId",
			"value": ""
		},
		{
			"id": "6f513bc9-db04-484b-bafd-3f2ca0e81fcc",
			"key": "RoleId",
			"value": ""
		},
		{
			"id": "af8a8312-67bf-4c54-a498-2aa044d0e7c5",
			"key": "UserId",
			"value": ""
		}
	],
	"protocolProfileBehavior": {}
}